window.Wg=window.Wg||{};Wg.Stockists=Wg.Stockists||function(){function e(i,r,f){$.when(o("stockist-map-pin")).done(function(e){var a,v,s;for(t=e,a=_.template(e),v=[],s=0;s<r.length;s++){var l=$(r[s]),k=l.find(".details"),h=l.data(),o=k.data(),d=new google.maps.LatLng(h.lat,h.lng),y=h.shop,g=h.stockistid,p=o.name,nt=o.address1,tt=o.address2,it=o.town,rt=o.county,ut=o.postcode,ft=o.telephonenumber,et=o.email,ot=o.url,w=o.othershops,b=[];w!=null&&(b=w.split(","));var st=a({stockistName:p,stockistAddress:_.reject([nt,tt,it,rt,ut],function(n){return!n}).join("<br />"),stockistTelephoneNumber:ft,stockistEmail:et,stockistUrl:ot,stockistBrands:b}),ht=y!=null?"/_images/brands/"+y+"/map-icons/map-pin.png":"",c=new google.maps.Marker({icon:ht,position:d,title:p,map:i,zIndex:9999-s,html:st,animation:google.maps.Animation.DROP,customInfo:g});f&&n.bounds.extend(c.position);v.push(c);n.markers[l.attr("id")]=c;google.maps.event.addListener(c,"click",function(){u("result_"+this.customInfo,!0)})}f&&i.fitBounds(n.bounds)})}function o(n){return t!=null?t:$.ajax({url:"/_js/template/"+n+".html",type:"GET",dataType:"html"})}function u(t){var i=n.markers[t],u,r,f;i&&(u=n.map,n.infoWindow||(n.infoWindow=new google.maps.InfoWindow),r=n.infoWindow,r.close(),r.setContent(i.html),r.open(u,i),u.panTo(i.position),f=$("#whereToBuyResults ul.results > li").first().position().top,$("#whereToBuyResults").stop(!0,!0).animate({scrollTop:$("#"+t).position().top-f},500))}function s(t){var u=$("#whereToBuyResults").find("ul.results"),f=u.data("region")!="1",i=u.children("li"),r;i.length>0&&(t=t||i.first().attr("id"),r=$("#"+t),n.baseLatLng=new google.maps.LatLng(r.data("lat"),r.data("lng")),n.bounds=new google.maps.LatLngBounds,n.mapOptions={zoom:14,center:n.baseLatLng,mapTypeId:google.maps.MapTypeId.ROADMAP},n.map=new google.maps.Map(document.getElementById("map_canvas"),n.mapOptions),google.maps.event.addListenerOnce(n.map,"tilesloaded",function(){e(n.map,i,f)}))}function i(){return $("#StockistSearchIsVisible").val("false"),$("#collections, #container").show(),$("#map_content").fadeOut(function(){$(".leftMenu").animate({left:"-420",avoidCSSTransitions:!0},500,function(){n.map=null;n.bounds=null;n.infowindow=null;n.mapOptions={};n.markers={};n.baseLatLng=null;n.markerClusterer=null;r();$("#StockistSearchIsVisible").val("true");$("#map_content").html('<a class="closeMaps button">Close Maps<\/a><div id="map_canvas"><\/div>');$("#whereToBuyResults").getNiceScroll().remove();$("#whereToBuyResults").empty().css("overflow","auto");$(".leftMenu").removeClass("leftMenu").css({height:"auto",top:"auto",left:"0px",bottom:"-100px"}).animate({left:"0",bottom:"35",avoidCSSTransitions:!0})})}),!1}function r(){$(".error.alertInfo").hide();var n=$("#SiteKey").val();$("#stockistSearch .large-8 ul li").hide();$("#whereToBuySearch, #stockistSearch").find(".stockistSearchTerms .field").hide();switch($("#Region").val()){case"1":$("#Postcode").parent().show();$("#Postcode").attr("placeholder","Enter Postcode, Town or City");$("#HasWallpaper").parents("li").show();$("#HasFabric").parents("li").show();$("#HasTrimmings").parents("li").show();$("#HasHomeAccessories").parents("li").show();$("#HasRugs").parents("li").show();n=="Zoffany"?($("#HasPaint").parents("li").show(),$("#HasFurniture").parents("li").show()):n=="Sanderson"&&$("#HasPaint").parents("li").show();break;case"2":$("#EuropeanCountryId").parent().show();$("#HasWallpaper").parents("li").show();$("#HasFabric").parents("li").show();$("#HasTrimmings").parents("li").show();$("#HasRugs").parents("li").show();n=="Zoffany"?($("#HasPaint").parents("li").show(),$("#HasFurniture").parents("li").show()):n=="Sanderson"&&$("#HasPaint").parents("li").show();break;case"3":$("#StateId").parent().show();$("#HasWallpaper").parents("li").show();$("#HasFabric").parents("li").show();$("#HasTrimmings").parents("li").show();break;case"4":$("#WorldCountryId").parent().show();$("#HasWallpaper").parents("li").show();$("#HasFabric").parents("li").show();$("#HasTrimmings").parents("li").show()}}var f,t=null,n={map:null,bounds:null,infowindow:null,mapOptions:{},markers:{},markerClusterer:null,baseLatLng:null,GoogleMapsLoaded:function(){Redant.util.loadScript("/_js/vendor/markerclusterer_compiled.js",function(){setTimeout(function(){for(var i=$(".leftMenu .results > li"),n=0,t=0;t<i.length;t++)n=n+$(i[t]).outerHeight();$(".leftMenu .scroller").height(Math.ceil(n));$("#map_content").fadeIn(function(){s()});$("#collections, #container").hide();$("#whereToBuyResults").niceScroll({})},500)})},hideStockists:function(){i()},setAjaxLocation:function(){var n="",t="",i="",r="",u="";if($("#Region").val()!="1"||$("#Postcode").val()!=""){u=$("#Region option:selected").text();switch($("#Region").val()){case"1":n=$("#Region option:selected").text()+" "+$("#Postcode").val();break;case"2":n=$("#EuropeanCountryId option:selected").text();break;case"3":n=$("#StateId option:selected").text()+"  United States of America";break;case"4":n=$("#WorldCountryId option:selected").text()}t=new google.maps.Geocoder;t.geocode({address:n},function(n,t){var u,f;t==google.maps.GeocoderStatus.OK&&(i=n[0].geometry.location.A,r=n[0].geometry.location.F,$("#Latitude").val(i),$("#Longitude").val(r),u=$("#whereToBuySearch .formControls"),u.find(".button").hide(),f=Redant.util.ajaxLoaderForButton().css("display","inline-block"),f.appendTo(u),$.ajax({type:"POST",url:"/actionuri/stockist/stockist/footer",data:$("#whereToBuySearch form").serialize(),success:function(n){$("#whereToBuy").replaceWith(n);$("#whereToBuy").addClass("leftMenu").css({top:"50%"}).show().animate({left:"0",avoidCSSTransitions:!0},500);Wg.Stockists.GoogleMapsLoaded()}}).always(function(){f.remove();u.find(".button").show()}))})}},init:function(){$(document).ready(function(){$("body").on("submit","#whereToBuySearch form",function(n){return(n.preventDefault(),$("#PostcodeError").hide(),$("#Region").val()=="1"&&$("#Postcode").val()=="")?($("#PostcodeError").show(),!1):(Redant.util.loadScript("https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&callback=Wg.Stockists.setAjaxLocation")&&Wg.Stockists.setAjaxLocation(),!1)}).on("click",".showOnMap",function(n){return n.preventDefault(),mapElemId=$(this).parents("li").attr("id"),u(mapElemId,!0),!1}).on("click",".closeMaps",function(n){return n.preventDefault(),i(),!1}).on("click",".toggleStockist",function(n){n.preventDefault();resetMenu();var t=$("#whereToBuy");return t.is(":visible")?($(this).removeClass("highlightedMenu"),i()):($("#StockistSearchIsVisible").val("true"),t.css({bottom:"-50px",display:"block",opacity:"1"}),$("#whereToBuyResults").getNiceScroll().remove(),$("#whereToBuyResults").css("overflow",""),r(),t.animate({bottom:"50%",left:"50%",avoidCSSTransitions:!0},500,function(){$("#whereToBuyResults .scroller").hasClass("iScollInit")&&(f=new IScroll("#whereToBuyResults .scroller",{eventPassthrough:!1,scrollX:!0,scrollY:!1,wheelHorizontal:!0}))})),!1}).on("click",".setDefaultStockist",function(n){n.preventDefault();var t=$(this);$.get(this.href,function(n){n.success==!0&&($(".setDefaultStockist").removeClass("selected").removeAttr("disabled"),t.addClass("selected"),t.attr("disabled","disabled"))})}).on("change","#Region",function(){r()})})}};return n}();Wg.Stockists.init();
//# sourceMappingURL=stockist.min.js.map
