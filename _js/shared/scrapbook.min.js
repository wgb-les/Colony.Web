function setScrapbookItem(n,t){var e,o,s,i,r,u,f,h,c;return t.scrapbookItemId=parseInt(n.data("scrapbookitemid")),e=parseInt(n.data("skuid")||t.skuId),t.skuId=e,t.description=n.data("description")||t.description,o=parseInt(n.data("imageassetid")||parseInt(n.attr("data-imageassetid"))||t.imageAssetId),t.imageAssetId=o,s=parseInt(n.css("z-index")),t.zIndex=s,n.hasClass("deleted")?(i=null,r=null,u=null,f=null,t.isOnCanvas=!1):(i=parseInt(n.css("top")),r=parseInt(n.css("left")),u=parseInt($(".ui-wrapper",n).height()),f=parseInt($(".ui-wrapper",n).width()),t.isOnCanvas=!0),t.top=i,t.left=r,t.height=u,t.width=f,h=getAngle($(".ui-wrapper",n)),t.rotation=h,t.scrapbookId=$("#ScrapbookId").val(),c=$("#scrapBook .added .scrapInner img"),t.img=c.attr("src"),t}function pushToServer(n,t,i,r){var u=Redant.util.ajaxLoader();$("body").append(u);u.css({"z-index":"9999",bottom:"40px"});u.show();$(".save-scrapbook").text("Saving!");scrapbookSaveXhr=$.ajax({url:n,data:t,type:"POST",async:i,contentType:"application/json",success:function(n){r&&r(n);requestTimeout(function(){$(".save-scrapbook").text("Saved!")},1300);requestTimeout(function(){$(".save-scrapbook").text("Save")},3e3);u.fadeOut();u.remove()}})}function createScrapbook(){var n=JSON.stringify(scrapbook);pushToServer("/scrapbook/moodboards/createscrapbookdata",n,!1,function(n){refreshFields(n)})}function updateScrapbook(){var n=JSON.stringify(scrapbook);pushToServer("/scrapbook/moodboards/updatescrapbookdata",n,!1,function(n){refreshFields(n)})}function refreshFields(n){$("#ScrapbookId").val(n.id);scrapbook.id=n.id;scrapbook.name=n.name;document.title="Moodboard - "+(scrapbook.name||"New Moodboard");$(".breadcrumb li").last().text(scrapbook.name||"New Moodboard");$("#share form").attr("action","/Sharing/Share/SendToAFriend?shareUrl="+encodeURIComponent(n.shareUrl));$(".shareOptions .twitter").attr("href",n.twitterUrl);$(".shareOptions .facebook").attr("href",n.facebookUrl);$(".shareOptions .pinterest, .scrapControls #pinterestShare").attr("href",n.pinterestUrl);$("#shareButton").show().css("display","")}function addScrapbookItem(n,t){scrapbook.id==0&&createScrapbook();scrapbookItem=new Scrap;setScrapbookItem(n,scrapbookItem);var i=JSON.stringify(scrapbookItem);pushToServer("/scrapbook/moodboards/additem",i,!0,function(i){scrapbook.items.push(new Scrap(i));var r=i.scrapbookItemId;n.data("scrapbookitemid",r).attr("id","scrapbookItem_"+r);n.attr("data-scrapbookitemid",r);$('div[id^="scrapbookItemInner_"]',n).attr("id","scrapbookItemInner_"+r);t&&t();refreshScrapbookList();getProducts()})}function saveScrapbookItem(n,t){var i=$(n).data("scrapbookitemid"),r,u,f;if(i==""||i==null||i=="undefined")return addScrapbookItem(n,t);r=getScapbookItem(i);r!=null&&(setScrapbookItem(n,r),u=JSON.stringify(r),f="/scrapbook/moodboards/updateitem",scrapbookSaveXhr=pushToServer(f,u,!0,function(n){t&&t();for(var i in scrapbook.items)if(scrapbook.items[i].scrapbookItemId==n.scrapbookItemId){scrapbook.items[i]=n;break}refreshScrapbookList();getProducts()}))}function getScapbookItem(n){var t=n,r,i;return t==null&&(r=$("#scrapBook .scrap.selected"),t=r.data("scrapbookitemid")),t=parseInt(t),i=scrapbook.items.filter(function(n){return n.scrapbookItemId==t}),i.length==0?null:i[0]}function initialize(){if(!isMoving){if(scrapbook.items.length>0){var n=_.template($("script.scrapbookTemplate").html());$("#scrapBook").html(n({scrapbookItems:scrapbook.items}));$(selectedItem).trigger("mousedown");$.each(scrapbook.items,function(){this.isOnCanvas&&$("#scrapControls").fadeIn(300)})}initializeScrapbookDraggables();$("#scrapBook .scrap").each(function(){var n=$(this),f=$(this).find(".scrapInner"),t=$(this).find(".scrapInner img"),r=n.data("scrapbookitemid"),i=getScapbookItem(r),u=i!=null?i.rotation:0;t.resizable({aspectRatio:!0,handles:"se",minHeight:120,minWidth:120,resize:function(n,t){touch==!1&&$(this).css({top:parseInt(t.position.top,10)+(t.originalSize.height-t.size.height)/2,left:parseInt(t.position.left,10)+(t.originalSize.width-t.size.width)/2})},stop:function(n,t){saveScrapbookItem($(t.helper).closest("div.scrap"))}});n.draggable({revert:!1,containment:$("#scrapBook"),start:function(){console.log("dragging");$("body").bind("touchmove",function(n){n.preventDefault()})},stop:function(n,t){saveScrapbookItem(t.helper);$("body").unbind("touchmove")}});t.parent().rotatable({mtx:getMatrix(-u)})});$("#scrapBook").droppable({accept:function(n){if(n.hasClass("scrapAdd")||n.attr("id")=="bar")return!0},drop:handleMoodboardDrop});$(".scrap:not('.added')").draggable("disable");$(".productList.scrapBookList .item.greyOut").draggable("disable");selectedItem&&setSelectedScrap(selectedItem)}}function initializeScrapbookDraggables(){$("#draggables").length==0&&$("body").prepend('<div id="draggables"><\/div>');$(".scrapBookList.scrapBookList .item").draggable({appendTo:"#draggables",helper:function(){return $copy=$(this).clone()},cursor:"move",revert:"invalid",zIndex:999999999,start:function(n,t){t.helper.css("width","200px");t.helper.css("height","200px");t.helper.find("ul").remove();t.helper.find("h3").remove();t.helper.find("div.actions").remove()}})}function handleMoodboardDrop(n,t){var r=t.draggable.clone(),c=$("#scrapBook"),l=$(c).find(".scrap").length,o=r.data("scrapbookitemid"),a=r.data("skuid"),v=r.data("imageassetid"),y=r.find("h3").text(),f,e;r.find("ul").remove();r.find("h3").remove();r.removeClass("scrapAdd");$("#scrapbookItem_"+o).remove();f=r.find("img").css({height:200,width:200,margin:0,resize:"none",position:"static",zoom:1,display:"block"});e=$(f).data("image-zoom");e!=null&&f.attr("src",e);f.addClass("ui-resizable");var p=_.template($("script.scrapbookTemplate").html()),s=[],i=new Scrap;i.height=200;i.width=200;i.left=t.offset.left-70;i.top=t.offset.top-164;i.scrapbookItemId=o;i.skuId=a;i.imageAssetId=v;i.zIndex=l;i.imageUrl=f.attr("src");i.description=y;s.push(i);var u=$(p({scrapbookItems:s})),w=u,b=$(".scrapInner",u),h=$(".scrapInner img, .scrapInner span, .scrapInner a",u);h.resizable({aspectRatio:!0,handles:"se",minHeight:120,minWidth:120,resize:function(n,t){touch==!1&&$(this).css({top:parseInt(t.position.top,10)+(t.originalSize.height-t.size.height)/2,left:parseInt(t.position.left,10)+(t.originalSize.width-t.size.width)/2})},stop:function(n,t){saveScrapbookItem($(t.helper).closest("div.scrap"))}});w.draggable({revert:!1,containment:$("#scrapBook")});h.parent().rotatable();saveScrapbookItem(u,function(){$("#scrapBook").append(u);$("#scrapControls").fadeIn(300);setSelectedScrap(u);$(".scrapBoobWelcome").fadeOut(400,function(){$(this).remove()})})}function getProducts(){var n=$("#ScrapbookId").val();return n==null&&(n=0),$.ajax({url:"/scrapbook/moodboards/products",data:{scrapbookId:n},cache:!1,success:function(n){$("#productsListContainer").html(n);n!=null&&n!=""&&$("a.sample").show()}})}function getScrapbook(){var n=$("#ScrapbookId").val()||0;if(n!=null&&n!=0)return $.ajax({url:"/scrapbook/moodboards/scrapbookdata",data:{scrapbookId:n},cache:!1,success:function(n){scrapbook=new Scrapbook(n);initialize()}})}function refreshScrapbookList(){var n=$("#ScrapbookId").val()||0;if(n!=null&&n!=0)return $.ajax({url:"/scrapbook/moodboards/scrapbookitemslist",data:{scrapbookId:n},cache:!1,success:function(n){$("#itemsInScrapbook").replaceWith(n);setCarousels();initializeScrapbookDraggables()}})}function getAngle(n){var u=n.css("-webkit-transform")||n.css("-moz-transform")||n.css("-ms-transform")||n.css("-o-transform")||n.css("transform")||null;if(u){var t=u.split("(")[1].split(")")[0].split(","),r=t[0],i=t[1],e=t[2],o=t[3],f=Math.sqrt(r*r+i*i),s=i/f;return Math.round(Math.atan2(i,r)*(180/Math.PI))}return 0}function degToRad(n){return n*(Math.PI/180)}function radToDeg(n){return n*(180/Math.PI)}function getMatrix(n){var t=Math.cos(degToRad(-n)),i=Math.sin(degToRad(-n));return[t,i,-i,t]}function setSelectedScrap(n){$("#scrapBook .scrap").removeClass("selected");var t=$(n).data("scrapbookitemid");selectedItem=$('.scrap[data-scrapbookitemid="'+t+'"]');$(selectedItem).addClass("selected");$(selectedItem).addClass("border-dashed");$(".selected .ui-resizable-handle, .selected .rotatable-handle").fadeIn()}var scrapbookSaveXhr;_.templateSettings.variable="rc";var selectedItem,saveTimer,disableAjaxCall,isMoving,touch,Scrapbook=function(n){this.id=0;this.name="";this.items=n!=null?new ScrapCollection(n.items):new ScrapCollection;for(var t in n)this[t]=n[t]},ScrapCollection=function(n){var t=[];for(var i in n)t.push(new Scrap(n[i]));return t},Scrap=function(n){this.scrapbookItemId=null;this.zIndex=0;this.name="";this.description="";this.imageUrl="";this.top=0;this.left=0;this.height=0;this.width=0;this.rotation=0;this.scrapbookId=null;this.skuId=null;this.imageAssetId=null;this.isOnCanvas=!1;for(var t in n)this[t]=n[t]},ScrapList=function(n){this.items=new ScrapCollection(n)},scraps,scrapbook=new Scrapbook;$(document).ready(function(){touch=Redant.util.browser.isTouchDevice();$(document.body).on("click",".item .actions a.plus",function(n){var i;if(n.preventDefault(),n.stopPropagation(),i=$(this).closest(".item"),i!=null){var r=$("#scrapBook"),u=$(i).clone(),t=$(u);t.css({"z-index":-1,top:200,left:200,position:"absolute"});t.appendTo("body");handleMoodboardDrop({},{draggable:t,offset:t.offset()});$("html,body").animate({scrollTop:r.position().top-$("#header").outerHeight()},1e3)}return!1});$(".save-scrapbook").click(function(){return scrapbook.name=$("#scrapbookName").val(),$(this).text("Saving"),scrapbook.id==0?createScrapbook():updateScrapbook(),requestTimeout(function(){$(".save-scrapbook").text("Saved!")},1300),requestTimeout(function(){$(".save-scrapbook").text("Save")},3e3),!1});$(document.body).on("mousedown","#scrapBook .scrap",function(n){setSelectedScrap(this);n.stopPropagation()});setTimeout(function(){$("#scrapBookContainer").animate({height:480},400,function(){$(".loading-scrapbook").fadeOut()})},3e3);touch==!1?$("#scrapBookContainer").mouseenter(function(){$("#scrapControls, .selected .ui-resizable-handle, .selected .rotatable-handle").fadeIn();$(".scrap.selected").addClass("border-dashed")}).mouseleave(function(){$("#scrapControls, .selected .ui-resizable-handle, .selected .rotatable-handle").fadeOut();$(".scrap.selected").removeClass("border-dashed")}):$("#scrapControls").show();$(document.body).on("click","#scrapBookSamples .productList .item",function(n){return n.preventDefault(),$(this).hasClass("selected")?$(this).removeClass("selected"):($(this).addClass("selected"),$("#noItemsSelected").hide()),!1});$(document.body).on("click","#scrapBookSamples #selectAllProducts",function(){$("#scrapBookSamples .productList .item").each(function(){$(this).hasClass("selected")?$(this).removeClass("selected"):($(this).addClass("selected"),$("#noItemsSelected").hide())})});$(document.body).on("click","#printButton",function(n){n.preventDefault();$("#print-info").foundation("reveal","open")});$(document.body).on("click","#shareButton",function(n){n.preventDefault();$("#share").foundation("reveal","open")});$(document.body).on("click","a.button.sample",function(n){n.preventDefault();$("#scrapBookSamples").foundation("reveal","open")});$(document.body).on("click","#scrapBookSamples .AddToBasket",function(){var n=[],t;return $("#scrapBookSamples .productList .item.selected").length==0&&$("#noItemsSelected").show(),$("#scrapBookSamples .productList .item.selected").each(function(){n.push($(this).data("skuid"))}),n.length>0?($("#noItemsSelected").hide(),t="/basket/action/?command=add&skuid="+n.join(","),$.get(t,function(n){if($("body .notification").remove(),n.Status==="Successful")$('<div class="notification"><h2 class="icon-shopping-cart">&#160;Item(s) Added to Basket<\/h2><\/div>').prependTo("body"),$("#scrapBookSamples").foundation("reveal","close"),getProducts(),getMiniBasketPartial();else{var t=[];$.each(n.BasketErrors,function(n,i){t.push(i.Message)});$("#basketErrors").html(t.join("<br/><br/>"));$("#basketErrors").show()}$(".notification").animate({right:"0px",avoidCSSTransitions:!0},500,function(){});setTimeout(function(){$(".notification").animate({right:"-1000px",avoidCSSTransitions:!0},500,function(){})},6e3);jQuery.fx.interval=20})):$("#noItemsSelected").show(),!1});$.when(getScrapbook()).done(function(){initialize()});$("#scrapbookName").keyup(function(n){var t=n.keyCode?n.keyCode:n.which;t==13&&(scrapbook.name=$(this).val(),scrapbook.id==0?createScrapbook():updateScrapbook(),$("#scrapbookName").blur())});$(document.body).on("click","#scrapControls .button",function(n){var i=$(".scrap.selected"),r=i.siblings(".scrap.added"),u=r.map(function(){return $(n.currentTarget).css("z-index")}),t=parseInt(i.css("z-index"));switch(n.currentTarget.id){case"top":t=$("#scrapBook .scrap").length+1;break;case"zup":t+=1;break;case"zdown":t-=1;break;case"bottom":t=0;break;case"remove":$(".selected").addClass("deleted");$(".deleted").fadeOut(300,function(){})}return t===-1&&(t=0,r.each(function(){var n=parseInt($(this).css("z-index"))+1;$(this).css("z-index",n);$(this).find(".zIndex").text(n)})),i.css({zIndex:t}),saveScrapbookItem(i),n.stopPropagation(),!1});$(document.body).on("click","div.item div.actions a.remove",function(n){n.preventDefault();var t=$(this),i=t.closest("div.item");pushToServer(t.attr("href"),null,!0,function(n){if(n.Success){var t=i.data("scrapbookitemid");t==null||t=="undefined"?i.fadeOut(300):($("#scrapBook div#scrapbookItem_"+t).fadeOut(300),getProducts(),refreshScrapbookList())}})})});
/*
//# sourceMappingURL=scrapbook.min.js.map
*/