function closeIframeWindow(){$("#popup").foundation("reveal","close");popup=!1}window.Wg=window.Wg||{};Wg.b2b=Wg.b2b||function(){function b(){var t=$.map($(".productCode input.referenceProductCode"),function(n){return n.value||""}).join("|"),u=$.map($(".productCode input.webAccount"),function(n){return n.value||""}).join("|"),l=$.map($(".productCode input.searchTerm"),function(n){return n.value||""}).join("|"),f=$.map($(".cuttingType"),function(n){return $(n).find("label").has("input[value='C']").hasClass("selected")?"1":""}).join("|"),e=$.map($(".cuttingType"),function(n){return $(n).find("label").has("input[value='S']").hasClass("selected")?"1":""}).join("|"),o=$.map($(".cuttingType"),function(n){return $(n).find("label").has("input[value='L']").hasClass("selected")?"1":""}).join("|"),s=$.map($(".cuttingType"),function(n){return $(n).find("label").has("input[value='R']").hasClass("selected")?"1":""}).join("|"),h=$("#OrderReference").val(),c=$("#SpecialInstructions").val();i(n+"/redant/quickbuyorder.aspx",function(n){var t=n.split("\n")[0],i;t&&t.length>2&&t.toLowerCase().indexOf("<order")>=0?(t=t.substring(1,t.length-1),i=$(t).find("order"),r("Thank you for your order","medium","","<h2>Customer "+window.selectedCustomerRef+"<\/h2><h2>Your order was successful<\/h2><h3>Thank you for your order "+i.attr("number")+"<\/h3><p><strong>"+i.attr("type")+"<\/strong> order<br /><strong>Brand<\/strong> "+i.attr("brand")+'<\/p><p>Your order has been received and is being processed.  Please feel free to <a href="/contact-us/" title="contact us">contact us<\/a> if you have any questions.<\/p><p>Your order is accepted at the discretion of the Seller. Payment does not indicate order acceptance and your payment will be refunded if your offer is refused.<\/p>'),$(".quickPurchase tbody tr").not(".autoCompleteRow").remove()):r("There was a problem placing your order","medium","","<h2>Customer "+window.selectedCustomerRef+'<\/h2><h2>There was a problem placing your order<\/h2><p>Your order was unsuccessful.  Please feel free to <a href="/contact-us/" title="Contact Us">contact us<\/a> if you have any questions.<\/p>')},"productCodes="+t+"&cuttings="+f+"&shorts="+e+"&longs="+o+"&returnables="+s+"&accounts="+u+"&OrderReference="+h+"&SpecialInstructions="+c)}function r(n,t,i,r){t===""&&(t="medium");var u=$('<div id="popup" class="reveal-modal '+t+" "+i+'"><header class="header-reveal-modal"><h2>'+n+'<\/h2><a class="close-reveal-modal icon-remove"><span>Close<\/span><\/a><\/header><div class="bd-reveal-modal"><\/div>');u.children("div.bd-reveal-modal").append(r);$("body #popup").remove();$("body").append(u);$("#popup").foundation("reveal","open",{close:function(){s=!1;k()}});showWidget();s=!0}function k(){$(".ui-widget-content").hover(function(){$(this).hide()})}function d(){window.location.href.toLowerCase().indexOf("/trade-members/login")<0&&(window.location="/trade-members/login/?returnUrl=%2Fb2b-members%2Fwebtex%2F")}function i(n,t,i,r,u,f){(r===""||r===null||r===undefined)&&(r="POST");(u===""||u===null||u===undefined)&&(u="json");i===undefined&&(i=null);f===undefined&&(f=!0);$.support.cors=!0;$.ajax({url:n,method:r,cache:!1,crossDomain:!0,data:i,dataType:u,async:f,xhrFields:{withCredentials:!0},success:t})}function g(){window.$zopim||function(n,t){var i=$zopim=function(n){i._.push(n)},r=i.s=n.createElement(t),u=n.getElementsByTagName(t)[0];i.set=function(n){i.set._.push(n)};i._=[];i.set._=[];r.async=!0;r.setAttribute("charset","utf-8");r.src="//v2.zopim.com/?28GknwDR6q7FM6sMVnnptC2GKCIupEhr";i.t=+new Date;r.type="text/javascript";u.parentNode.insertBefore(r,u)}(document,"script")}function h(n){var t;t=n.length>10?n.substring(0,10)+"...":n;$("#customerName a span.global-util-label").html(t+'<span class="hide"> (Change Customer)<\/span>').attr("title",n+" (Change Customer)");$("#customerNameModal a span.global-util-label").html(n+'<span class="hide"> (Change Customer)<\/span>').attr("title",n+" (Change Customer)")}function e(){i(n+"/redant/getassignedcustomer.aspx",function(n){n.UserType==="C"?($("#customer a").remove(),window.selectedCustomerRef=n.CustomerRef):n.Valid===!0&&n.CustomerRef!==""&&n.CustomerRef.indexOf(",")<1?(window.selectedCustomerRef=n.CustomerRef,h(n.CustomerName)):(n.CustomerRef===""||n.CustomerRef.indexOf(",")>0)&&y()})}function c(){i(n+"/redant/ssologout.aspx",function(){},null,"POST","json",!1);i("/b2b-members/logout/",function(){d()})}function l(){i(n+"/redant/ping.aspx",function(n){n.Valid!==!0&&c()})}function nt(){$(document.body).off("click",".addToBasket");$(document.body).off("click","a.addToBasket").off("click","a.b2baddtobasket").off("click","a.b2baddsampletobasket").on("click","a.b2bdisabled",function(n){return n.preventDefault(),!1}).on("click",'.b2baddtobasket:not(".b2bdisabled")',function(i){var o,s;return i.preventDefault(),window.selectedCustomerRef===""?e():(o=$(this).parents(".productDetails, .details").attr("data-productcode")||$(this).parent().attr("data-productcode"),sitekey.toLowerCase()==="wg"&&(o=$(this).parents(".b2bhelper").attr("data-productcode")||$(this).parent().attr("data-productcode")),t=o.indexOf("UZGC")>-1?f:u,s=n+"/Content/OrderEntryLineExt/Default.aspx?RETURN_URL="+window.location.origin+"/closepopup.html&ITEM_ID="+o+"&CAIF_ACCOUNT="+t+"&LINE_NO=*&RELOAD=Y&ORDER_TYPE=N&FRMWRK=N&CUSREF="+window.selectedCustomerRef+"&THEME="+sitekey.toUpperCase(),r("Add to Basket","large","",'<iframe src="'+s+'" style="border: none; width: 625px!important;height: 470px!important;"><\/iframe>')),!1}).on("click",'.b2baddsampletobasket:not(".b2bdisabled")',function(i){var o,s;return i.preventDefault(),window.selectedCustomerRef===""?e():(o=$(this).parents(".productDetails, .details").attr("data-productcode")||$(this).parent().attr("data-productcode"),sitekey.toLowerCase()==="wg"&&(o=$(this).parents(".b2bhelper").attr("data-productcode")||$(this).parent().attr("data-productcode")),t=o.indexOf("UZGC")>-1?f:u,s=n+"/Content/OrderEntryLineExt/Default.aspx?RETURN_URL="+window.location.origin+"/closepopup.html&ITEM_ID="+o+"&CAIF_ACCOUNT="+t+"&LINE_NO=*&RELOAD=Y&ORDER_TYPE=Y&FRMWRK=N&CUSREF="+window.selectedCustomerRef+"&THEME="+sitekey.toUpperCase(),r("Add Sample to Basket","large","",'<iframe src="'+s+'" style="border: none; width: 625px!important;height: 470px!important;"><\/iframe>')),!1}).on("click",'.b2beditbasket:not(".b2bdisabled")',function(i){var o;if(i.preventDefault(),window.selectedCustomerRef==="")e();else{o=$(this).parents(".productDetails, .details").attr("data-productcode");sitekey.toLowerCase()==="wg"&&(o=$(this).parents(".b2bhelper").attr("data-productcode")||$(this).parent().attr("data-productcode"));t=o.indexOf("UZGC")>-1?f:u;var s=$(this).attr("data-linenumber"),h=$(this).attr("data-customerref")||window.selectedCustomerRef,c=n+"/Content/OrderEntryLineExt/Default.aspx?RETURN_URL="+window.location.origin+"/closepopup.html&CAIF_ACCOUNT="+t+"&LINE_NO="+s+"&RELOAD=Y&ORDER_TYPE=N&FRMWRK=N&CUSREF="+h+"&THEME="+sitekey.toUpperCase();r("Edit Item","large","",'<iframe src="'+c+'" style="border: none; width: 625px!important;height: 470px!important;"><\/iframe>')}return!1}).on("click",'.b2beditsamplebasket:not(".b2bdisabled")',function(i){var o;if(i.preventDefault(),window.selectedCustomerRef==="")e();else{o=$(this).parents(".productDetails, .details").attr("data-productcode");t=o.indexOf("UZGC")>-1?f:u;var s=$(this).attr("data-linenumber"),h=$(this).attr("data-customerref")||window.selectedCustomerRef,c=n+"/Content/OrderEntryLineExt/Default.aspx?RETURN_URL="+window.location.origin+"/closepopup.html&CAIF_ACCOUNT="+t+"&LINE_NO="+s+"&RELOAD=Y&ORDER_TYPE=Y&FRMWRK=N&CUSREF="+h+"&THEME="+sitekey.toUpperCase();r("Edit Sample","large","",'<iframe src="'+c+'" style="border: none; width: 625px!important;height: 470px!important;"><\/iframe>')}return!1})}function a(){var r=$("*[data-productcode]"),u=$("#ProductCodes"),t="";r.length>0&&(t+=r.map(function(){return $(this).attr("data-productcode")}).get().join(","));u.length>0&&(t+=u.val());t.length>0&&(r.find(".b2baddtobasket, .b2baddsampletobasket, .b2beditbasket, .b2beditsamplebasket").addClass("b2bdisabled"),i(n+"/redant/pricelist.aspx",function(n){var r,t,i;if(n&&n.Items.length>0)for(r=n.Currency||"GBP",t=0;t<n.Items.length;t++)n.Items[t].Price!=null&&n.Items[t].Price!=undefined&&n.Items[t].Price!="-.--"&&(i=r+" "+n.Items[t].Price,$('*[data-productcode="'+n.Items[t].Product_Code+'"] .price').not('[data-noprice="true"]').length>0&&$("#webcontractuser").length==0?$('*[data-productcode="'+n.Items[t].Product_Code+'"] .price').not('[data-noprice="true"]').text(i):$("#webcontractuser").length==0&&$('*[data-productcode="'+n.Items[t].Product_Code+'"]').not('[data-noprice="true"]').append('<span class="price">'+i+"<\/span>"),$('*[data-productcode="'+n.Items[t].Product_Code+'"] .stock')&&$("#webcontractuser").length==0&&(n.Items[t].StockLevel>0?$('*[data-productcode="'+n.Items[t].Product_Code+'"] .stock').text("Stock Level: "+n.Items[t].StockLevel+n.Items[t].StockLevelUnitOfMeasurement):$('*[data-productcode="'+n.Items[t].Product_Code+'"] .stock').html("Stock Level: "+n.Items[t].StockLevel+n.Items[t].StockLevelUnitOfMeasurement+"<br/>Stock Due: "+n.Items[t].DueIn)),$('*[data-productcode="'+n.Items[t].Product_Code+'"]').find(".b2baddtobasket, .b2baddsampletobasket, .b2beditbasket, .b2beditsamplebasket").removeClass("b2bdisabled"))},"ProductCodes="+t))}function v(t,r){i(n+"/redant/GetCustomers.aspx?term="+t.term,function(n){var t=$.map(n,function(n){return{label:n.CUSName+" ("+n.CUSREF+" - "+n.SELLCO+")",value:n.CUSREF,name:n.CUSName}});r(t)})}function y(){var t=$('<div class="contentForm"><div class="field text autocomplete"><label for="b2bcustomerselection">Start typing a customer name and select an option from the list<\/label><input type="text" id="b2bcustomerselection" name="b2bcustomerselection" placeholder="Start typing a customer name..." /><\/div><\/div>');t.find("input").autocomplete({source:v,minLength:3,select:function(t,r){r.item&&i(n+"/redant/setcustomer.aspx?CUSREF="+r.item.value+"&CUSName="+r.item.name,function(){window.selectedCustomerRef=r.item.value;h(r.item.name.trim());closeIframeWindow();$(document).trigger("priceupdate")})},create:function(){setTimeout(function(){$("#b2bcustomerselection").focus()},500)}});r("Select Customer","small","",t)}function p(){var t=$.Deferred();return i(n+"/redant/minibasket.aspx",function(i){$("li.basket .miniBasket").remove();$.get("/_js/template/b2b-minibasket.html").done(function(r){$("li.basket").append(_.template(r,i,{variable:"basket"}));var u=i.AvailableBaskets.length;$("li.basket > a > span.global-util-count").text("("+u+")");$("li.basket input#switch").autocomplete({source:v,minLength:3,select:function(t,i){i.item&&($.support.cors=!0,$.ajax({url:n+"/redant/setcustomer.aspx?CUSREF="+i.item.value+"&CUSName="+encodeURIComponent(i.item.label),crossDomain:!0,dataType:"json",xhrFields:{withCredentials:!0},success:function(){}}))}});t.resolve(i)})},null,"POST","json"),t.promise()}function tt(){return($(this).find(".alertInfo").remove(),$(this).find("input[type='checkbox']:checked").length==0)?($(this).prepend('<div class="alertInfo error"><span>You must select a basket to continue to the secure checkout<\/span><\/div>'),!1):!0}function it(){window.location.href.toLowerCase().indexOf("b2bcheckout/payment")>0&&$("html, body").animate({scrollTop:$("#b2bPaymentSection").position().top-$("#header").outerHeight()},1e3)}var u="WG01.WEB",f="WG09.WEB",t="WG01.WEB",n="https://online.walkergreenbank.com/raintegration",u="WG01.WEB",f="WG09.WEB",t="WG01.WEB",o,w,s;return(window.location.href.indexOf("uat")||window.location.href.indexOf("staging")||window.location.href.indexOf("colonynext"))&&(n="https://online.walkergreenbank.com/raintegrationtrial",u="TRIAL2WG01.WEB",f="TRIAL2WG09.WEB",t="TRIAL2WG01.WEB"),o=Redant.util.browser.isMobile()||Redant.util.browser.isTablet()?"touchstart":"click",window.getMiniBasket=p,Wg.QuickPurchase&&($("table.quickPurchase").addClass("b2b"),Wg.QuickPurchase.orderHandlerDelegate=b),window.selectedCustomerRef="",w={returnValue:""},s=!1,{init:function(){window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""));$(window).load(function(){g();var n=$("*[data-productcode]");n.find("a.b2baddtobasket, a.b2baddsampletobasket, a.b2beditbasket, a.b2beditsamplebasket").addClass("b2bdisabled");l();setInterval(l,3e4);e();a();$(document).on("quickview:expanded productdragstop",function(){$(document).trigger("priceupdate")});nt()});$(document).ready(function(){it();p();$(".scrapControls .sample").remove();$(document).on("keydown",".field.orderreference input",function(n){var t=n.which||n.keyCode;return!n.shiftKey&&!n.altKey&&!n.ctrlKey&&t>=48&&t<=57||t>=96&&t<=105||t==189||t==109||t>=65&&t<=90||t==8||t==9||t==13||t==35||t==36||t==37||t==39||t==45?!0:!1});$(document).on(o,"#b2bLogout,.b2bLogout",function(){return c(),!1});$(document).on(o,"#b2bChangeCustomer,#customer a",function(){return y(),!1});$(document).on(o,"#b2bGoToBasket",function(n){return n.preventDefault(),window.location="/b2b-members/webtex/basketsummary/",!1});$("#siteLinks ul li.basket a").attr("href","/b2b-members/webtex/basketsummary/");_.each($("select.savedAddresses"),function(n){$(n).children("option:selected").val().length>0?$(n).parents("fieldset").children(".addressDetails").hide():$(n).parents("fieldset").children(".addressDetails").show()});$("select.savedAddresses").change(function(){$(this).children("option:selected").val().length>0?$(this).parents("fieldset").children(".addressDetails").hide():$(this).parents("fieldset").children(".addressDetails").show()});$(".b2bDelivery .addNewAddress").on("click",function(n){n.preventDefault();var r=this,t=$(r).data("custref"),f=$(r).data("custname"),i=$(r).data("iscfa")||!1,u=$("#addressDetails");return $.get("/b2b-members/b2bcheckout/AddDeliveryAddress?CustomerReference="+t+"&CustomerName="+f+"&isCfaAddress="+i,function(n){u.empty().html(n).append("").foundation("reveal","open");_.each($("select.savedAddresses"),function(n){$(n).children("option:selected").val().length>0?$(n).parents("fieldset").children(".addressDetails").hide():$(n).parents("fieldset").children(".addressDetails").show()});$("select.savedAddresses").change(function(){$(this).children("option:selected").val().length>0?$(this).parents("fieldset").children(".addressDetails").hide():$(this).parents("fieldset").children(".addressDetails").show()});$("#addressDetails form").on("submit",function(n){n.preventDefault();var r=$(this);return $.validator.unobtrusive.parse(r),$(r).valid()&&$.ajax({type:"POST",url:r.attr("action"),data:r.serialize(),success:function(n){var s=i?".cfa ":" ",o=i?".deliveryAddress.cfa ul":".deliveryAddress:not(.cfa) ul",r,e,f;if(n.success&&n.success===!0){for(r=n.address.split("|"),e=$("#"+t).find(o),e.length==0&&(e=$("<ul>").prependTo("#"+t+" "+o)),e.empty().append("<li><strong>"+r[0]+"<\/strong><\/li>"),f=1;f<r.length;f++)r[f]!=="Y"&&r[f]!=="D"&&r[f]!=="T"&&e.append("<li>"+r[f]+"<\/li>");$("#"+t+" .b2bDeliveryAddressHeader"+s).text("Selected"+(i?" CFA ":" ")+" Delivery Address");u.foundation("reveal","close")}}}),!1})}),!1});$("form.basketTotals").submit(tt);$("#b2bAcceptTermsAndConditions").on("change",function(){var n=$(this).prop("checked");n?$("#termsAndConditionsError").hide():$("#termsAndConditionsError").show()});$("form#b2bMakePayment").submit(function(){var n=$("#b2bAcceptTermsAndConditions").prop("checked");return n?$("#termsAndConditionsError").hide():$("#termsAndConditionsError").show(),n});$('input[type="radio"][name="paymentType"]').on("change",function(){var n=$(this).val();$("#billingAddress").hide();n=="card"&&$("#billingAddress").show()});$(document).on("priceupdate",function(){a()})})},b2bNavigation:function(){i(n+"/redant/clientinfo.aspx",function(n){var u=n.nav.Nav.menu.menuitem,t=$('<header class="pageHeader"><nav class="top-bar" role="navigation"><ul class="title-area"><li class="name"><a href="#"><h1>B2B Menu<\/h1><\/a><\/li><li class="toggle-topbar menu-icon"><a href="#"><span><\/span><\/a><\/li><\/ul><section class="top-bar-section"><ul><li><a href="/b2b-members/webtex/?webtexUrl=%2F">Home<\/a><\/li><\/ul><\/section><\/nav><\/header>'),i='<li><a href="/b2b-members/webtex/?webtexUrl=<%=item.link%>"><%=(item.title || "")%><\/a><\/li>',r=t.find(".top-bar-section ul");_.each(u,function(n){var t=$(_.template(i,n,{variable:"item"})),u;n.menu&&n.menu.menuitem.length>0&&(t.addClass("has-dropdown"),u=$('<ul class="dropdown"><\/ul>'),_.each(n.menu.menuitem,function(n){u.append(_.template(i,n,{variable:"item"}))}),t.append(u),r.append(t))});r.append('<li><a href="/shop/quick-order/">Quick Order<\/a><\/li><li><a href="/trade/">Trade Area<\/a><li><a class="b2bLogout" href="#">Log Off<\/a><\/li>');Redant.util.browser.isMobile()||(sitekey.toLowerCase()==="wg"?$(".pageContainerInner").prepend(t):$("#container").prepend(t));$(document).foundation("off").foundation()})}}}();Wg.b2b.init();
//# sourceMappingURL=b2b.min.js.map
